from datetime import datetime

from telegram import InputMediaPhoto
from telegram import InputMediaAudio
from telegram import InputMediaDocument
from telegram import InputMediaVideo
from telegram.constants import ParseMode

from bot import entity

STATUS_VALUES = ["pending", "approved", "hidden"]

DISTINCT_VALUES = [
    "–ì–∞–ª–∏—Ü—å–∫–∏–π",
    "–ó–∞–ª—ñ–∑–Ω–∏—á–Ω–∏–π",
    "–õ–∏—á–∞–∫—ñ–≤—Å—å–∫–∏–π",
    "–§—Ä–∞–Ω–∫—ñ–≤—Å—å–∫–∏–π",
    "–®–µ–≤—á–µ–Ω–∫—ñ–≤—Å—å–∫–∏–π",
    "–°–∏—Ö—ñ–≤—Å—å–∫–∏–π",
]
BUILDING_TYPE_VALUES = ["–Ω–æ–≤–æ–±—É–¥–æ–≤–∞", "–Ω–µ –Ω–æ–≤–æ–±—É–¥–æ–≤–∞ (—á–µ—à–∫–∞, —Ö—Ä—É—â–æ–≤–∫–∞, —Ç–æ—â–æ)"]

POST_START = (
    "–î–ª—è —Ç–æ–≥–æ —â–æ–± —Ä–æ–∑–º—ñ—Å—Ç–∏—Ç–∏ –í–∞—à–µ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è —Ç—Ä–µ–±–∞ –ø—Ä–æ–π—Ç–∏ –¥–µ–∫—ñ–ª—å–∫–∞ –ø—Ä–æ—Å—Ç–∏—Ö "
    "–∫—Ä–æ–∫—ñ–≤. –ù–µ –ø–µ—Ä–µ–π–º–∞–π—Ç–µ—Å—å —è–∫—â–æ —â–æ—Å—å –≤–∫–∞–∑–∞–ª–∏ –Ω–µ–≤—ñ—Ä–Ω–æ, –í–∏ –∑–º–æ–∂–µ—Ç–µ "
    "–≤—ñ–¥—Ä–µ–¥–∞–≥—É–≤–∞—Ç–∏ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è –ø—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –≤—Å–∏—Ö –∫—Ä–æ–∫—ñ–≤."
    "\n\n–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó: –ø–æ—Å—Ç–∞—Ä–∞–π—Ç–µ—Å—å –æ—Ñ–æ—Ä–º–∏—Ç–∏ –í–∞—à–µ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è –≥–∞—Ä–Ω–æ, "
    "–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –ø—Ä–∏ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ —ñ–Ω—Ñ–æ–≥—Ä–∞—Ñ—ñ–∫–∏, –∑–≥—ñ–¥–Ω–æ –∑ "
    "–≤–∏—â–µ–∑–≥–∞–¥–∞–Ω–∏–º–∏ –∫—Ä–∏—Ç–µ—Ä—ñ—è–º–∏, —Ç–æ–¥—ñ –í–∞—à–∞ –ø—É–±–ª—ñ–∫–∞—Ü—ñ—è –±—É–¥–µ —Ä–æ–∑–º—ñ—â–µ–Ω–∞ –≤ "
    "—Ç–µ–ª–µ–≥—Ä–∞–º –∫–∞–Ω–∞–ª—ñ —ñ —ó—ó –∑–º–æ–∂—É—Ç—å –∑–Ω–∞–π—Ç–∏ –æ—Ä–µ–Ω–¥–∞—Ä—ñ."
)

ASK_DISTINCT = "–û–±–µ—Ä—ñ—Ç—å —Ä–∞–π–æ–Ω"
ASK_STREET = "–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –≤—É–ª–∏—Ü—ñ"
ASK_BUILDING_TYPE = "–û–±–µ—Ä—ñ—Ç—å —Ç–∏–ø –±—É–¥–∏–Ω–∫—É"
ASK_FLOOR = "–í–≤–µ–¥—ñ—Ç—å –Ω–æ–º–µ—Ä –ø–æ–≤–µ—Ä—Ö—É (–≤—ñ–¥ 1 –¥–æ 27)"
ASK_SQUARE = "–í–≤–µ–¥—ñ—Ç—å –∑–∞–≥–∞–ª—å–Ω—É –ø–ª–æ—â—É –∫–≤–∞—Ä—Ç–∏—Ä–∏ –≤ –º¬≤"
ASK_NUM_OF_ROOMS = "–í–≤–µ–¥—ñ—Ç—å –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∫—ñ–º–Ω–∞—Ç (–≤—ñ–¥ 1 –¥–æ 6)"
ASK_LAYOUT = (
    "–í–≤–µ–¥—ñ—Ç—å –æ—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ –ø–ª–∞–Ω—É–≤–∞–Ω–Ω—è: "
    "—Å–ø–∞–ª—å–Ω—è, –∫—É—Ö–Ω—è-—Å—Ç—É–¥—ñ—è, –∫–∞–±—ñ–Ω–µ—Ç, —Ä–æ–∑–¥—ñ–ª—å–Ω–∏–π —Å–∞–Ω–≤—É–∑–æ–ª, —Ç–æ—â–æ"
)
ASK_DESCRIPTION = (
    "–í–≤–µ–¥—ñ—Ç—å –æ–ø–∏—Å: –º–µ–±–ª—ñ, –ø–æ–±—É—Ç–æ–≤–∞ —Ç–µ—Ö–Ω—ñ–∫–∞, "
    "—ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞, —ñ–Ω—à—ñ –æ—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ"
)
ASK_SETTLEMENT_DATE = "–í–≤–µ–¥—ñ—Ç—å –¥–∞—Ç—É –º–æ–∂–ª–∏–≤–æ–≥–æ –∑–∞—Å–µ–ª–µ–Ω–Ω—è —É —Ñ–æ—Ä–º–∞—Ç—ñ –¥–¥.–º–º.—Ä—Ä"
ASK_PRICE = (
    "–í–≤–µ–¥—ñ—Ç—å —Ü—ñ–Ω—É —É USD (–≤ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—ñ —Ü—ñ–Ω–∞ –±—É–¥–µ –≤–∫–∞–∑–∞–Ω–∞ —É –¥–æ–ª–ª–∞—Ä–∞—Ö "
    "—ñ –≥—Ä–∏–≤–Ω—ñ –µ–∫–≤—ñ–≤–∞–ª–µ–Ω—Ç–Ω–æ –∫—É—Ä—Å—É –Ω–∞ –ø–æ—Ç–æ—á–Ω–∏–π –¥–µ–Ω—å)"
)
ASK_CONTACT = (
    "–í–≤–µ–¥—ñ—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é: —ñ–º‚Äô—è, –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É/—Ç–µ–ª–µ–≥—Ä–∞–º, "
    "–≤–ª–∞—Å–Ω–∏–∫ —á–∏ —Ä—ñ—î–ª—Ç–æ—Ä, –ø—Ä–∏–≤–∞—Ç–Ω–æ —á–∏ –Ω–∞–∑–≤–∞ –∞–≥–µ–Ω—Ü—ñ—ó, –∫–æ–º–ø–∞–Ω—ñ—ó."
)
ASK_PHOTO = "–ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ —Ñ–æ—Ç–æ, –ø–æ –∑–∞–≤–µ—Ä—à–µ–Ω—é –≤–≤–µ–¥—ñ—Ç—å /done"

SUBMIT_ADVERT = (
    "üü¢ –î—è–∫—É—é, —â–æ –ø–æ–¥–∞–ª–∏ –∑–∞—è–≤–∫—É –Ω–∞ –ø—É–±–ª—ñ–∫–∞—Ü—ñ—é –∂–∏—Ç–ª–∞. –ú–∏ —Ä–æ–∑–≥–ª—è–Ω–µ–º–æ –í–∞—à–µ "
    "–æ–≥–æ–ª–æ—à–µ–Ω–Ω—è –π —É —Ä–∞–∑—ñ –ø–æ–∑–∏—Ç–∏–≤–Ω–æ–≥–æ —Ä—ñ—à–µ–Ω–Ω—è –æ–ø—É–±–ª—ñ–∫—É—î–º–æ –π–æ–≥–æ —É –∫–∞–Ω–∞–ª—ñ. "
    "–Ø–∫—â–æ –≤ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—ñ –Ω–µ –±—É–¥–µ –≤–∏—è–≤–ª–µ–Ω–æ –ø–æ–º–∏–ª–æ–∫, –≤–æ–Ω–æ –æ—Ç—Ä–∏–º–∞—î —Å—Ç–∞—Ç—É—Å "
    "–ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ. –Ø–∫—â–æ —Ö–æ—á–µ—Ç–µ –ø–æ–¥–∞—Ç–∏ –±—ñ–ª—å—à–µ –ø—É–±–ª—ñ–∫–∞—Ü—ñ–π, —Ç–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ —â–µ —Ä–∞–∑ "
    "–Ω–∞—Ç–∏—Å–Ω—É—Ç–∏ ‚Äú/post‚Äù —ñ –≤–∏–∫–æ–Ω–∞—Ç–∏ —Ä–∞–Ω—ñ—à–µ –∑–≥–∞–¥–∞–Ω—ñ —É–º–æ–≤–∏."
)

CHOOSE_TO_EDIT = "–û–±–µ—Ä—ñ—Ç—å –ø–æ–ª–µ –¥–ª—è —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è"
CANT_EDIT = "üî¥ –ù–∞–∂–∞–ª—å, –Ω–µ –º–æ–∂–Ω–∞ —Ä–µ–¥–∞–≥—É–≤–∞—Ç–∏ –æ–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω—ñ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è."
CANCEL = "üü¢ –í—ñ–¥–º—ñ–Ω–µ–Ω–æ."
EDIT_DONE = "üü¢ –í—ñ–¥—Ä–µ–¥–∞–≥–æ–≤–∞–Ω–æ."
FLOOR_VALUE_ERROR = (
    "üî¥ –ë—É–¥—å-–ª–∞—Å–∫–∞ –≤–≤–µ–¥—ñ—Ç—å –∑–Ω–∞—á–µ–Ω–Ω—è –≤ –º–µ–∂–∞—Ö –≤—ñ–¥ 1 –¥–æ 27, "
    "–∞–±–æ –≤–≤–µ–¥—ñ—Ç—å /cancel –¥–ª—è –≤—ñ–¥–º—ñ–Ω–∏."
)
NUM_OF_ROOMS_VALUE_ERROR = (
    "üî¥ –ë—É–¥—å-–ª–∞—Å–∫–∞ –≤–≤–µ–¥—ñ—Ç—å –∑–Ω–∞—á–µ–Ω–Ω—è –≤ –º–µ–∂–∞—Ö –≤—ñ–¥ 1 –¥–æ 6, "
    "–∞–±–æ –≤–≤–µ–¥—ñ—Ç—å /cancel –¥–ª—è –≤—ñ–¥–º—ñ–Ω–∏."
)
DATE_VALUE_ERROR = (
    "üî¥ –ë—É–¥—å-–ª–∞—Å–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –¥–∞—Ç—É, –º–æ–∂–ª–∏–≤–æ –í–∏ –≤–≤–µ–ª–∏ –Ω–µ –≤ —Ñ–æ—Ä–º–∞—Ç—ñ –¥–¥.–º–º.—Ä—Ä. "
    "–ù–∞–ø—Ä–∏–∫–ª–∞–¥: 24.08.22, "
    "–∞–±–æ –≤–≤–µ–¥—ñ—Ç—å /cancel –¥–ª—è –≤—ñ–¥–º—ñ–Ω–∏."
)

TEXT_INPUT_ERROR = "üî¥ –ë—É–¥—å-–ª–∞—Å–∫–∞ –≤–≤–µ–¥—ñ—Ç—å —Ç–µ–∫—Å—Ç"

PHOTO_VALUE_ERROR = (
    "üî¥ –ë—É–¥—å-–ª–∞—Å–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ —Ö–æ—á–∞–± –æ–¥–Ω–µ —Ñ–æ—Ç–æ. "
    "–Ø–∫—â–æ –í–∏ –∑–∞–≤–µ—Ä—à–∏–ª–∏ –≤–≤–µ–¥—ñ—Ç—å /done –¥–ª—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è, "
    "–∞–±–æ –≤–≤–µ–¥—ñ—Ç—å /cancel –¥–ª—è –≤—ñ–¥–º—ñ–Ω–∏."
)
PHOTO_MAX_LIMIT_ERROR = "üò¢ –ù–∞–∂–∞–ª—å —Ç–µ–ª–µ–≥—Ä–∞–º –¥–æ–∑–≤–æ–ª—è—î –¥–æ–¥–∞—Ç–∏ –ª–∏—à–µ 10 —Ñ–æ—Ç–æ."

EDIT_MARKUP = {
    "distinct": "–†–∞–π–æ–Ω",
    "street": "–í—É–ª–∏—Ü—è",
    "building_type": "–¢–∏–ø –±—É–¥–∏–Ω–∫—É",
    "floor": "–ü–æ–≤–µ—Ä—Ö",
    "square": "–ü–ª–æ—â–∞",
    "num_of_rooms": "–ö—ñ–ª—å–∫—ñ—Å—Ç—å –∫—ñ–º–Ω–∞—Ç",
    "layout": "–ü–ª–∞–Ω—É–≤–∞–Ω–Ω—è",
    "description": "–û–ø–∏—Å",
    "settlement_date": "–î–∞—Ç–∞ –º–æ–∂–ª–∏–≤–æ–≥–æ –∑–∞—Å–µ–ª–µ–Ω–Ω—è",
    "price": "–¶—ñ–Ω–∞",
    "contact": "–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ñ –¥–∞–Ω—ñ",
    "photo": "–§–æ—Ç–æ",
}


KEYBOARD_SELECT_VALUE_ERROR = (
    "üî¥ –ë—É–¥—å-–ª–∞—Å–∫–∞ –æ–±–µ—Ä—ñ—Ç—å –µ–ª–µ–º–µ–Ω—Ç –∑—ñ —Å–ø–∏—Å–∫—É –∞–±–æ –≤–≤–µ–¥—ñ—Ç—å /cancel –¥–ª—è –≤—ñ–¥–º—ñ–Ω–∏."
)


def make_advert_post(
    data: entity.Advert,
    index: int = None,
    show_submit: bool = True,
    show_status=False,
) -> list[
    InputMediaAudio | InputMediaDocument | InputMediaPhoto | InputMediaVideo
]:
    media: list[
        InputMediaAudio
        | InputMediaDocument
        | InputMediaPhoto
        | InputMediaVideo
    ]

    status_map = {
        entity.StatusEnum.PENDING: "—Ä–æ–∑–≥–ª—è–¥–∞—î—Ç—å—Å—è",
        entity.StatusEnum.APPROVED: "–ø—Ä–∏–π–Ω—è—Ç–æ",
        entity.StatusEnum.HIDDEN: "–ø—Ä–∏—Ö–æ–≤–∞–Ω–æ",
    }
    status = (
        f"\n<b>–°—Ç–∞—Ç—É—Å:</b> {status_map[data.status]}" if show_status else ""
    )
    edit = f"\n/edit{index or ''} - —Ä–µ–¥–∞–≥—É–≤–∞—Ç–∏"
    submit = "\n/submit - –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏" if show_submit else ""
    delete = f"\n/delete{index or ''} - –≤–∏–¥–∞–ª–∏—Ç–∏" if not show_submit else ""
    cancel = "\n/cancel - –≤—ñ–¥–º—ñ–Ω–∞" if show_submit else ""

    media = [InputMediaPhoto(p) for p in data.photo]
    media[-1].parse_mode = ParseMode.HTML
    media[-1].caption = (
        f"<b>–†–∞–π–æ–Ω:</b> {data.distinct}\n"
        f"<b>–í—É–ª–∏—Ü—è:</b> {data.street}\n"
        f"<b>–¢–∏–ø –±—É–¥–∏–Ω–∫—É:</b> {data.building_type}\n"
        f"<b>–ü–æ–≤–µ—Ä—Ö:</b> {data.floor}\n"
        f"<b>–ü–ª–æ—â–∞:</b> {data.square} –º¬≤\n"
        f"<b>–ö—ñ–ª—å–∫—ñ—Å—Ç—å –∫—ñ–º–Ω–∞—Ç:</b> {data.num_of_rooms}\n"
        f"<b>–ü–ª–∞–Ω—É–≤–∞–Ω–Ω—è:</b> {data.layout}\n"
        f"<b>–û–ø–∏—Å:</b> {data.description}\n"
        f"<b>–î–∞—Ç–∞ –º–æ–∂–ª–∏–≤–æ–≥–æ –∑–∞—Å–µ–ª–µ–Ω–Ω—è:</b> "
        f"{data.settlement_date.strftime('%d.%m.%y')}\n"
        f"<b>–¶—ñ–Ω–∞:</b> {data.price} $\n"
        f"<b>–ö–æ–Ω—Ç–∞–∫—Ç–∏:</b> {data.contact}\n"
        f"{status}"
        f"{submit}"
        f"{edit}"
        f"{delete}"
        f"{cancel}"
    )

    return media


def make_filter_msg(data: dict) -> str:
    distinct = ", ".join(data["distinct"]) if data["distinct"] else "–í—Å—ñ"
    building_type = ", ".join(data["building_type"]) if data["building_type"] else "–í—Å—ñ"
    floor = data["floor"]
    price = data["price"]
    num_of_rooms = data["num_of_rooms"]

    msg = (
        f"<b>–†–∞–π–æ–Ω:</b> {distinct}\n"
        f"<b>–¢–∏–ø –±—É–¥–∏–Ω–∫—É:</b> {building_type}\n"
        f"<b>–ü–æ–≤–µ—Ä—Ö:</b> {floor}\n"
        f"<b>–¶—ñ–Ω–∞:</b> {price}\n"
        f"<b>–ö—ñ–ª—å–∫—ñ—Å—Ç—å –∫—ñ–º–Ω–∞—Ç:</b> {num_of_rooms}\n"
    )

    return msg
